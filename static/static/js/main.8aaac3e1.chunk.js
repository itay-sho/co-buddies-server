(this["webpackJsonpco-buddies"]=this["webpackJsonpco-buddies"]||[]).push([[0],{102:function(e,t,a){},103:function(e,t,a){},104:function(e,t,a){},108:function(e,t){},110:function(e,t){},143:function(e,t){},144:function(e,t){},186:function(e,t,a){},187:function(e,t,a){},204:function(e,t,a){},205:function(e,t,a){},207:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(96),c=a.n(o),s=(a(102),a(29)),l=a(12),u=a(5),i=(a(103),a(104),function(e){var t=e.text,a=e.author,n=e.user_id,o=localStorage.getItem("USER_ID"),c=n.toString()===o?"message-self":"message-other",s={};0===n&&(s.color="red");return r.a.createElement("div",{className:"Message "+c},r.a.createElement("div",{className:"message-author",style:s},[a]),r.a.createElement("div",{className:"message-text",style:{direction:function(e){return null!=e[0]&&e[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl"}(t)}},t))}),d={OK:0,UNAUTHENTICATED:100,CONVERSATION_CLOSED:101,SCHEMA_ERROR:102,UNIMPLEMENTED:103,CONVERSATION_NOT_INITIALIZED:104,AUTHENTICATION_TIMEOUT:105,AUTH_FAIL_USER_INACTIVE:106,AUTH_FAIL_INVALID_TOKEN:107,INACTIVENESS_TIMEOUT:108,UNKNOWN_ERROR:109},m=a(47),g=a.n(m),f=a(23),b=a.n(f),p=r.a.createContext({conversationId:0,setConversationId:function(){},websocket:null,setWebsocket:function(){},getNextSequenceNumber:function(){}}),v=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),o=a[0],c=a[1],s=Object(n.useState)(null),l=Object(u.a)(s,2),i=l[0],d=l[1],m=Object(n.useState)(1),g=Object(u.a)(m,2),f=g[0],b=g[1];return r.a.createElement(p.Provider,{value:{conversationId:o,setConversationId:c,websocket:i,setWebsocket:d,getNextSequenceNumber:function(){return b(f+1),f}}},e.children)},E=a(48),h=a.n(E),N=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)(null),s=Object(u.a)(c,2),m=s[0],f=s[1],v=Object(n.useRef)({0:"\u05d4\u05d5\u05d3\u05e2\u05ea \u05de\u05e2\u05e8\u05db\u05ea"}),E=Object(n.useRef)({}),N=Object(n.useRef)(),I=Object(n.useRef)(),_=Object(n.useContext)(p),O=localStorage.getItem("USER_ID"),y=function(e,t){console.log("Adding!");var a={};a[e]=t,E.current=g()(E.current,{$set:a})},S=function(e){o((function(t){return g()(t,{$push:[e]})}))},w=function(){return b.a.randomBytes(10).toString("hex")},x=function(e,t){return{user_id:e,text:t,key:w()}},j=function(e){return x(0,e)},T=function(){var e=_.getNextSequenceNumber(),t=JSON.stringify({request_type:"request_match",seq:e,payload:{}});I.current.send(t),console.log("match request sent!"),y(e,C)},A=function(){S(j("\u05d4\u05ea\u05d7\u05d1\u05e8\u05ea \u05d1\u05d4\u05e6\u05dc\u05d7\u05d4!")),T()},C=function(){S(j("\u05de\u05d7\u05e4\u05e9 \u05e4\u05e8\u05d8\u05e0\u05e8\u05d9\u05dd \u05dc\u05e9\u05d9\u05d7\u05d4..."))},R=function(e){var t=I.current,a=_.getNextSequenceNumber(),n=JSON.stringify({request_type:"authenticate",seq:a,payload:{access_token:localStorage.getItem("API_KEY")}});t.send(n),y(a,A)},k=function(e){S(j("\u05d4\u05ea\u05e0\u05ea\u05e7\u05ea \u05de\u05d4\u05e9\u05e8\u05ea, \u05e0\u05e1\u05d4 \u05dc\u05e8\u05e4\u05e8\u05e9 \u05d0\u05ea \u05d4\u05d3\u05e3"))},U=function(e){console.log("New message: "+e.data);var t=JSON.parse(e.data);switch(t.request_type){case"error":return function(e){switch(e.payload.error_code){case d.OK:null!=e.payload.response_to&&(console.dir(E.current),console.log(e.payload.response_to),e.payload.response_to in E.current?E.current[e.payload.response_to]():console.log("got a success message for seq: "+e.payload.response_to));break;case d.AUTH_FAIL_INVALID_TOKEN:case d.AUTH_FAIL_USER_INACTIVE:S(j("\u05d4\u05e1\u05d9\u05e1\u05de\u05d4 \u05e9\u05e0\u05d9\u05ea\u05e0\u05d4 \u05e9\u05d2\u05d5\u05d9\u05d4 \u05d0\u05d5 \u05e9\u05d4\u05de\u05e9\u05ea\u05de\u05e9 \u05e0\u05d7\u05e1\u05dd. \u05de\u05ea\u05e0\u05ea\u05e7...")),localStorage.removeItem("API_KEY");break;case d.AUTHENTICATION_TIMEOUT:S(j("\u05d4\u05de\u05e2\u05e8\u05db\u05ea \u05e0\u05db\u05e9\u05dc\u05d4 \u05d1\u05d4\u05ea\u05d7\u05d1\u05e8\u05d5\u05ea"));break;case d.INACTIVENESS_TIMEOUT:S(j("\u05de\u05ea\u05e0\u05ea\u05e7 \u05d1\u05e2\u05e7\u05d1\u05d5\u05ea \u05d7\u05d5\u05e1\u05e8 \u05e4\u05e2\u05d9\u05dc\u05d5\u05ea...")),_.setConversationId(0);break;default:S(j("Unknown error: ".concat(e.payload.error_code," ").concat(e.payload.error_message)))}}(t);case"receive_match":return function(e){var t=localStorage.getItem("USER_ID"),a="";console.log(e.payload.attendees);for(var n=0,r=Object.entries(e.payload.attendees);n<r.length;n++){var o=Object(u.a)(r[n],2),c=o[0],s=o[1];t!==c&&(a+=s);var i=Object(l.a)({},v.current);i[c]=s,v.current=i}S(j("\u05d0\u05ea\u05d4 \u05de\u05d3\u05d1\u05e8 \u05e2\u05dd "+a)),_.setConversationId(e.payload.conversation_id)}(t);case"receive_message":return function(e){null!==m&&e.payload.author_id.toString()!==O&&m.play(),S(x(e.payload.author_id,e.payload.text))}(t);case"disconnect":return function(e){console.log(e.payload),console.log(v.current),console.log(v.current[e.payload.user_id]);var t=v.current[e.payload.user_id];S(j("".concat(t," \u05e2\u05d6\u05d1 \u05d0\u05ea \u05d4\u05e9\u05d9\u05d7\u05d4."))),_.setConversationId(0),T()}(t);default:return function(e){S(j("\u05d4\u05d5\u05d3\u05e2\u05d4 \u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2\u05d4! :"+JSON.stringify(e)))}(t)}};Object(n.useEffect)((function(){console.log("useEffect"),void 0===I.current&&(console.log("setting web socket..."),I.current=new WebSocket("wss://co-buddies.co.il/chat"),S({key:w(),user_id:0,text:"\u05de\u05ea\u05d7\u05d1\u05e8 \u05d0\u05dc \u05d4\u05e9\u05e8\u05ea..."})),I.current.onopen=R,I.current.onclose=k,I.current.onmessage=U,_.setWebsocket(I.current),N.current.scroll({top:N.current.scrollHeight,behavior:"smooth"})}),[I,R,k,U]),Object(n.useEffect)((function(){h.a.soundManager.onready((function(){if(null===m){var e=h.a.soundManager.createSound({url:"".concat("https://co-buddies.co.il/static","/new-message.wav")});f(e)}}))}),[]);var q={backgroundImage:"url(".concat("https://co-buddies.co.il/static","/chat_bg.png)")};return r.a.createElement("div",{className:"ChatBox",ref:N,style:q},a.map((function(e){return r.a.createElement("div",{key:e.key,className:"p-2"},r.a.createElement(i,{text:e.text,author:v.current[e.user_id],user_id:e.user_id}))})))},I=(a(186),r.a.forwardRef((function(e,t){var a=e.enterAction,o=e.disabled,c=Object(n.useState)({rows:e.rows,minRows:e.minRows,maxRows:e.maxRows,value:""}),s=Object(u.a)(c,2),i=s[0],d=s[1],m=Object(n.useState)({resize:"none",width:"100%",lineHeight:"24px",direction:"rtl"}),g=Object(u.a)(m,2),f=g[0],b=g[1];t.current=[i,d];return r.a.createElement("textarea",{disabled:o,maxLength:"500",rows:i.rows,placeholder:"\u05d4\u05e7\u05dc\u05d3\\\u05d9 \u05d4\u05d5\u05d3\u05e2\u05d4",className:"ResizeableTextarea",onKeyDown:function(e){if(13===e.keyCode&&!1===e.shiftKey){e.preventDefault();e.target.value;a()}},onChange:function(e){var t=i.minRows,a=i.maxRows,n=e.target.rows;e.target.rows=t;var r,o=~~((e.target.scrollHeight-20)/24);o===n&&(e.target.rows=o),o>=a&&(e.target.rows=a,e.target.scrollTop=e.target.scrollHeight),b(Object(l.a)({},f,{direction:(r=e.target,null!=r.value[0]&&r.value[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl")})),d(Object(l.a)({},i,{rows:o<a?o:a,value:e.target.value}))},style:f,value:i.value})}))),_=(a(187),function(){var e=Object(n.useContext)(p),t=0===e.conversationId,a=Object(n.useRef)(),o=function(){var n=Object(u.a)(a.current,2),r=n[0],o=n[1],c=r.value;if(!t&&0!==c.length){var s=e.getNextSequenceNumber(),i=JSON.stringify({request_type:"send_message",seq:s,payload:{text:c}});o(Object(l.a)({},r,{value:""})),e.websocket.send(i)}};return r.a.createElement("div",{className:"ChatInput mt-auto"},r.a.createElement("div",{className:"p-2 d-flex"},r.a.createElement(I,{ref:a,rows:"1",minRows:"1",maxRows:"5",enterAction:o,disabled:t}),r.a.createElement("div",{className:"p2 d-flex align-items-center send-button-wrapper"},r.a.createElement("img",{alt:"logo",src:"https://co-buddies.co.il/static/send_button.png",className:"send-button",onClick:o}))))}),O=a(30),y=a.n(O),S=function(){var e=Object(n.useState)(null!==localStorage.getItem("API_KEY")?"chat":"welcome"),t=Object(u.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)({fullName:"",age:"",reasonToIsolation:""}),i=Object(u.a)(c,2),d=i[0],m=i[1],g=function(e){var t=e.target.name;m(Object(l.a)({},d,Object(s.a)({},t,e.target.value)))},f=function(e){e.preventDefault();var t=b.a.randomBytes(10).toString("hex"),a=b.a.randomBytes(20).toString("hex");y.a.post("/registration/",{username:t,password1:a,password2:a,name:d.fullName,reason_to_isolation:d.reasonToIsolation,age:d.age}).then((function(e){201===e.status?(localStorage.setItem("API_KEY",e.data.key),localStorage.setItem("USER_ID",e.data.id),o("chat")):alert(e.status)}))};return r.a.createElement("div",{className:"ChatContainer container"},function(){switch(a){case"chat":return r.a.createElement("div",{className:"d-flex flex-column chat-flex"},r.a.createElement(N,null),r.a.createElement(_,null));case"welcome":return r.a.createElement("div",{className:"d-flex flex-column chat-flex justify-content-center"},r.a.createElement("div",{className:"text-center rtl no-chat-windows"},r.a.createElement("img",{src:"https://co-buddies.co.il/static/logo.png",alt:"logo",className:"logo"}),r.a.createElement("p",null,"\u05d1\u05e8\u05d5\u05db\u05d9\u05dd \u05d4\u05d1\u05d0\u05d9\u05dd \u05dc\u05d0\u05ea\u05e8 Co-Buddies!",r.a.createElement("br",null),"\u05d1\u05d0\u05ea\u05e8 \u05ea\u05d5\u05db\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8 \u05e2\u05dd \u05d7\u05d1\u05e8\u05d9\u05dd \u05e0\u05d5\u05e1\u05e4\u05d9\u05dd \u05d4\u05e0\u05de\u05e6\u05d0\u05d9\u05dd \u05d1\u05d1\u05d9\u05d3\u05d5\u05d3"),r.a.createElement("form",{onSubmit:f},r.a.createElement("div",{className:"p-2"},r.a.createElement("input",{type:"text",onChange:g,value:d.fullName,name:"fullName",placeholder:"\u05e9\u05dd",className:"chat-input",required:!0})),r.a.createElement("div",{className:"p-2"},r.a.createElement("input",{type:"number",onChange:g,value:d.age,name:"age",placeholder:"\u05d2\u05d9\u05dc",min:"1",className:"chat-input",required:!0})),r.a.createElement("div",{className:"p-2"},r.a.createElement("textarea",{onChange:g,value:d.reasonToIsolation,placeholder:"\u05e1\u05d9\u05d1\u05ea \u05d1\u05d9\u05d3\u05d5\u05d3",name:"reasonToIsolation",className:"chat-input",maxLength:"300",required:!0})),r.a.createElement("div",{className:"p-2"},r.a.createElement("input",{type:"submit",className:"btn btn-primary btn-lg",value:"\u05d4\u05ea\u05d7\u05d9\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8!"})))));default:return null}}())},w=(a(204),function(){return r.a.createElement("div",{className:"PageFooter fixed-bottom"},r.a.createElement("div",{className:"navbar"},r.a.createElement("div",{className:"float-left"},"Developed & designed by ",r.a.createElement("a",{href:"mailto:itai.sho@gmail.com?subject=\u05d4\u05d0\u05ea\u05e8 co-buddies \u05e9\u05dc\u05da"},"Itay Shoshani")),r.a.createElement("div",{className:"float-right"},r.a.createElement("a",{href:"https://github.com/itay-sho/co-buddies-server"},"Contribute")," to this project")))}),x=(a(205),a(206),function(){return r.a.createElement("div",{className:"App"},r.a.createElement(S,null),r.a.createElement(w,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));y.a.defaults.baseURL="https://co-buddies.co.il/",c.a.render(r.a.createElement(v,null,r.a.createElement(x,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},97:function(e,t,a){e.exports=a(207)}},[[97,1,2]]]);
//# sourceMappingURL=main.8aaac3e1.chunk.js.map