(this["webpackJsonpco-buddies"]=this["webpackJsonpco-buddies"]||[]).push([[0],{103:function(e,t,a){e.exports=a(217)},108:function(e,t,a){},109:function(e,t,a){},110:function(e,t,a){},114:function(e,t){},116:function(e,t){},149:function(e,t){},150:function(e,t){},196:function(e,t,a){},197:function(e,t,a){},214:function(e,t,a){},215:function(e,t,a){},217:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(102),r=a.n(c),s=(a(108),a(34)),l=a(11),u=a(4),i=(a(109),a(110),function(e){var t=e.text,a=e.author,n=e.user_id,c=localStorage.getItem("USER_ID"),r=n.toString()===c?"message-self":"message-other",s={};0===n&&(s.color="red");return o.a.createElement("div",{className:"Message "+r},o.a.createElement("div",{className:"message-author",style:s},[a]),o.a.createElement("div",{className:"message-text",style:{direction:function(e){return null!=e[0]&&e[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl"}(t)}},t))}),d={OK:0,UNAUTHENTICATED:100,CONVERSATION_CLOSED:101,SCHEMA_ERROR:102,UNIMPLEMENTED:103,CONVERSATION_NOT_INITIALIZED:104,AUTHENTICATION_TIMEOUT:105,AUTH_FAIL_USER_INACTIVE:106,AUTH_FAIL_INVALID_TOKEN:107,INACTIVENESS_TIMEOUT:108,UNKNOWN_ERROR:109},m=a(36),g=a.n(m),f=a(27),p=a.n(f),b=o.a.createContext({conversationId:-1,setConversationId:function(){},shouldRequestMatch:!0,setShouldRequestMatch:function(){},websocket:null,setWebsocket:function(){},getNextSequenceNumber:function(){}}),h=function(e){var t=Object(n.useState)(-1),a=Object(u.a)(t,2),c=a[0],r=a[1],s=Object(n.useState)(!0),l=Object(u.a)(s,2),i=l[0],d=l[1],m=Object(n.useState)(null),g=Object(u.a)(m,2),f=g[0],p=g[1],h=Object(n.useState)(1),v=Object(u.a)(h,2),E=v[0],N=v[1];return o.a.createElement(b.Provider,{value:{conversationId:c,setConversationId:r,shouldRequestMatch:i,setShouldRequestMatch:d,websocket:f,setWebsocket:p,getNextSequenceNumber:function(){return N(E+1),E}}},e.children)},v=a(53),E=a.n(v),N=a(28),_=(a(101),function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(null),s=Object(u.a)(r,2),m=s[0],f=s[1],h=Object(n.useState)(null),v=Object(u.a)(h,2),_=v[0],I=v[1],y=Object(n.useRef)({0:"\u05d4\u05d5\u05d3\u05e2\u05ea \u05de\u05e2\u05e8\u05db\u05ea"}),O=Object(n.useRef)({}),S=Object(n.useRef)(),j=Object(n.useRef)(),x=Object(n.useContext)(b),w=localStorage.getItem("USER_ID"),k=function(e,t){console.log("Adding pending response!");var a={};a[e]=t,O.current=g()(O.current,{$set:a})},R=function(e){c((function(t){return g()(t,{$push:[e]})}))},T=function(){return p.a.randomBytes(10).toString("hex")},q=function(e,t){return{user_id:e,text:t,key:T()}},C=function(e){return q(0,e)},A=function(){return null!==_},U=function(){if(!A()){var e=x.getNextSequenceNumber(),t=JSON.stringify({request_type:"request_match",seq:e,payload:{}});j.current.send(t),console.log("match request sent!"),k(e,K)}},M=function(e,t){var a;a=t.payload.response_to,console.log("Removing pending response!"),O.current=g()(O.current,{$unset:[a]}),e(t)},D=function(){R(C("\u05d4\u05ea\u05d7\u05d1\u05e8\u05ea \u05d1\u05d4\u05e6\u05dc\u05d7\u05d4!")),U(),W()},K=function(e){0===e.payload.error_code&&(R(C("\u05de\u05d7\u05e4\u05e9 \u05e4\u05e8\u05d8\u05e0\u05e8\u05d9\u05dd \u05dc\u05e9\u05d9\u05d7\u05d4...")),k(e.payload.response_to,H),I(e.payload.reponse_to))},L=function(){R(C("\u05d1\u05e7\u05e9\u05ea\u05da \u05dc\u05d4\u05e9\u05d0\u05e8 \u05d1\u05dc\u05d5\u05d1\u05d9 \u05d4\u05ea\u05e7\u05d1\u05dc\u05d4. \u05dc\u05d0 \u05de\u05d7\u05e4\u05e9 \u05e4\u05e8\u05d8\u05e0\u05e8\u05d9\u05dd")),I(null)},H=function(e){for(var t=[],a=0,n=Object.entries(e.payload.attendees);a<n.length;a++){var o=Object(u.a)(n[a],2),r=o[0],s=o[1];w!==r&&t.push(s);var i=Object(l.a)({},y.current);i[r]=s,y.current=i}c((function(){return[]})),1===e.payload.conversation_id?R(C("\u05e0\u05db\u05e0\u05e1\u05ea \u05dc\u05dc\u05d5\u05d1\u05d9")):I(null),t.length>=1&&R(C("\u05d0\u05ea\u05d4 \u05de\u05d3\u05d1\u05e8 \u05e2\u05dd "+t.join(", "))),x.setConversationId(e.payload.conversation_id)},F=function(){var e=j.current,t=x.getNextSequenceNumber(),a=JSON.stringify({request_type:"authenticate",seq:t,payload:{access_token:localStorage.getItem("API_KEY")}});e.send(a),k(t,D)},J=function(){R(C("\u05d4\u05ea\u05e0\u05ea\u05e7\u05ea \u05de\u05d4\u05e9\u05e8\u05ea, \u05e0\u05e1\u05d4 \u05dc\u05e8\u05e4\u05e8\u05e9 \u05d0\u05ea \u05d4\u05d3\u05e3")),x.setConversationId(-1)},V=function(e){console.log("New message: "+e.data);var t=JSON.parse(e.data);switch(t.request_type){case"error":return function(e){switch(e.payload.error_code){case d.OK:null!=e.payload.response_to&&(console.dir(O.current),console.log(e.payload.response_to),e.payload.response_to in O.current?M(O.current[e.payload.response_to],e):console.log("got a success message for seq: "+e.payload.response_to));break;case d.AUTH_FAIL_INVALID_TOKEN:case d.AUTH_FAIL_USER_INACTIVE:R(C("\u05d4\u05e1\u05d9\u05e1\u05de\u05d4 \u05e9\u05e0\u05d9\u05ea\u05e0\u05d4 \u05e9\u05d2\u05d5\u05d9\u05d4 \u05d0\u05d5 \u05e9\u05d4\u05de\u05e9\u05ea\u05de\u05e9 \u05e0\u05d7\u05e1\u05dd. \u05de\u05ea\u05e0\u05ea\u05e7...")),localStorage.removeItem("API_KEY");break;case d.AUTHENTICATION_TIMEOUT:R(C("\u05d4\u05de\u05e2\u05e8\u05db\u05ea \u05e0\u05db\u05e9\u05dc\u05d4 \u05d1\u05d4\u05ea\u05d7\u05d1\u05e8\u05d5\u05ea"));break;case d.INACTIVENESS_TIMEOUT:R(C("\u05de\u05ea\u05e0\u05ea\u05e7 \u05d1\u05e2\u05e7\u05d1\u05d5\u05ea \u05d7\u05d5\u05e1\u05e8 \u05e4\u05e2\u05d9\u05dc\u05d5\u05ea...")),x.setConversationId(-1);break;default:R(C("Unknown error: ".concat(e.payload.error_code," ").concat(e.payload.error_message)))}}(t);case"receive_match":return H(t);case"receive_message":return function(e){null!==m&&e.payload.author_id.toString()!==w&&m.play(),R(q(e.payload.author_id,e.payload.text))}(t);case"leave":return function(e){console.log(e.payload),console.log(y.current),console.log(y.current[e.payload.user_id]);var t=y.current[e.payload.user_id];R(C("".concat(t," \u05e2\u05d6\u05d1 \u05d0\u05ea \u05d4\u05e9\u05d9\u05d7\u05d4"))),1!==x.conversationId&&U()}(t);case"join":return function(e){console.log("connect message: ",e);var t=e.payload.user_id,a=e.payload.name,n=Object(l.a)({},y.current);n[t]=a,y.current=n,t.toString()!==w&&R(C("".concat(a," \u05d4\u05e6\u05d8\u05e8\u05e3 \u05dc\u05e9\u05d9\u05d7\u05d4")))}(t);default:return function(e){R(C("\u05d4\u05d5\u05d3\u05e2\u05d4 \u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2\u05d4! :"+JSON.stringify(e)))}(t)}},W=Object(n.useCallback)((function(){var e=N.messaging();e.getToken().then((function(e){var t=x.getNextSequenceNumber(),a=JSON.stringify({request_type:"set_pn_token",seq:t,payload:{token:e}});x.websocket.send(a)})).catch((function(e){console.log(e)})),e.onMessage((function(e){console.log("message",e)}))}),[x]);Object(n.useEffect)((function(){void 0===j.current&&(console.log("setting web socket..."),j.current=new WebSocket("wss://co-buddies.co.il/chat"),R({key:T(),user_id:0,text:"\u05de\u05ea\u05d7\u05d1\u05e8 \u05d0\u05dc \u05d4\u05e9\u05e8\u05ea..."})),j.current.onopen=F,j.current.onclose=J,j.current.onmessage=V,x.setWebsocket(j.current),S.current.scroll({top:S.current.scrollHeight,behavior:"smooth"})}),[j,F,J,V]),Object(n.useEffect)((function(){x.shouldRequestMatch?1===x.conversationId&&U():(console.log("sending unmatch request"),function(){if(A()){var e=x.getNextSequenceNumber(),t=JSON.stringify({request_type:"unrequest_match",seq:e,payload:{}});j.current.send(t),console.log("unmatch request sent!"),k(e,L)}}())}),[x.shouldRequestMatch,x.conversationId]),Object(n.useEffect)((function(){E.a.soundManager.onready((function(){if(null===m){var e=E.a.soundManager.createSound({url:"".concat("https://co-buddies.co.il/static","/new-message.wav")});f(e)}}))}),[]);var B={backgroundImage:"url(".concat("https://co-buddies.co.il/static","/chat_bg.png)")};return o.a.createElement("div",{className:"ChatBox",ref:S,style:B},a.map((function(e){return o.a.createElement("div",{key:e.key,className:"p-2"},o.a.createElement(i,{text:e.text,author:y.current[e.user_id],user_id:e.user_id}))})))}),I=(a(196),o.a.forwardRef((function(e,t){var a=e.enterAction,c=e.disabled,r=Object(n.useState)({rows:e.rows,minRows:e.minRows,maxRows:e.maxRows,value:""}),s=Object(u.a)(r,2),i=s[0],d=s[1],m=Object(n.useState)({resize:"none",width:"100%",lineHeight:"24px",direction:"rtl"}),g=Object(u.a)(m,2),f=g[0],p=g[1];t.current=[i,d];return o.a.createElement("textarea",{disabled:c,maxLength:"500",rows:i.rows,placeholder:"\u05d4\u05e7\u05dc\u05d3\\\u05d9 \u05d4\u05d5\u05d3\u05e2\u05d4",className:"ResizeableTextarea",onKeyDown:function(e){if(13===e.keyCode&&!1===e.shiftKey){e.preventDefault();e.target.value;a()}},onChange:function(e){var t=i.minRows,a=i.maxRows,n=e.target.rows;e.target.rows=t;var o,c=~~((e.target.scrollHeight-20)/24);c===n&&(e.target.rows=c),c>=a&&(e.target.rows=a,e.target.scrollTop=e.target.scrollHeight),p(Object(l.a)({},f,{direction:(o=e.target,null!=o.value[0]&&o.value[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl")})),d(Object(l.a)({},i,{rows:c<a?c:a,value:e.target.value}))},style:f,value:i.value})}))),y=(a(197),function(){var e,t=Object(n.useContext)(b),a=-1===t.conversationId,c=Object(n.useRef)(),r=function(){var e=Object(u.a)(c.current,2),n=e[0],o=e[1],r=n.value;if(!a&&0!==r.length){var s=t.getNextSequenceNumber(),i=JSON.stringify({request_type:"send_message",seq:s,payload:{text:r}});o(Object(l.a)({},n,{value:""})),t.websocket.send(i)}},s=null;switch(t.conversationId){case 1:e="\u05d7\u05d3\u05e8 \u05d4\u05de\u05ea\u05e0\u05d4";break;case-1:e=null;break;default:e="\u05e9\u05d9\u05d7\u05d4 \u05e4\u05e8\u05d8\u05d9\u05ea"}return null!==e&&(s=o.a.createElement("div",{className:"row m-0 chat-type"},o.a.createElement("div",{className:"px-2 ml-auto col-6 text-left"},o.a.createElement("label",{className:"form-check-label",htmlFor:"request_match_checkbox"},o.a.createElement("b",null,"\u05d7\u05e4\u05e9 \u05e9\u05d9\u05d7\u05d4 \u05d0\u05d9\u05e9\u05d9\u05ea")),o.a.createElement("input",{className:"form-check-input ml-1",type:"checkbox",id:"request_match_checkbox",checked:t.shouldRequestMatch,onChange:function(e){t.setShouldRequestMatch(e.target.checked)}})),o.a.createElement("div",{className:"px-2 mr-auto col-6 text-right"},"\u05d0\u05ea\u05d4 \u05e0\u05de\u05e6\u05d0 \u05db\u05e2\u05ea \u05d1",o.a.createElement("b",null,e)))),o.a.createElement("div",{className:"ChatInput mt-auto"},s,o.a.createElement("div",{className:"p-2 d-flex"},o.a.createElement(I,{ref:c,rows:"1",minRows:"1",maxRows:"5",enterAction:r,disabled:a}),o.a.createElement("div",{className:"p2 d-flex align-items-center send-button-wrapper"},o.a.createElement("img",{alt:"logo",src:"https://co-buddies.co.il/static/send_button.png",className:"send-button",onClick:r}))))}),O=a(35),S=a.n(O),j=function(){var e=Object(n.useState)(null!==localStorage.getItem("API_KEY")?"chat":"welcome"),t=Object(u.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)({fullName:"",age:"",reasonToIsolation:""}),i=Object(u.a)(r,2),d=i[0],m=i[1],g=function(e){var t=e.target.name;m(Object(l.a)({},d,Object(s.a)({},t,e.target.value)))},f=function(e){e.preventDefault();var t=p.a.randomBytes(10).toString("hex"),a=p.a.randomBytes(20).toString("hex");S.a.post("/registration/",{username:t,password1:a,password2:a,name:d.fullName,reason_to_isolation:d.reasonToIsolation,age:d.age}).then((function(e){201===e.status?(localStorage.setItem("API_KEY",e.data.key),localStorage.setItem("USER_ID",e.data.id),c("chat")):alert(e.status)}))};return o.a.createElement("div",{className:"ChatContainer container"},function(){switch(a){case"chat":return o.a.createElement("div",{className:"d-flex flex-column chat-flex"},o.a.createElement(_,null),o.a.createElement(y,null));case"welcome":return o.a.createElement("div",{className:"d-flex flex-column chat-flex justify-content-center"},o.a.createElement("div",{className:"text-center rtl no-chat-windows"},o.a.createElement("img",{src:"https://co-buddies.co.il/static/logo.png",alt:"logo",className:"logo"}),o.a.createElement("p",null,"\u05d1\u05e8\u05d5\u05db\u05d9\u05dd \u05d4\u05d1\u05d0\u05d9\u05dd \u05dc\u05d0\u05ea\u05e8 Co-Buddies!",o.a.createElement("br",null),"\u05d1\u05d0\u05ea\u05e8 \u05ea\u05d5\u05db\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8 \u05e2\u05dd \u05d7\u05d1\u05e8\u05d9\u05dd \u05e0\u05d5\u05e1\u05e4\u05d9\u05dd \u05d4\u05e0\u05de\u05e6\u05d0\u05d9\u05dd \u05d1\u05d1\u05d9\u05d3\u05d5\u05d3"),o.a.createElement("form",{onSubmit:f},o.a.createElement("div",{className:"p-2"},o.a.createElement("input",{type:"text",onChange:g,value:d.fullName,name:"fullName",placeholder:"\u05e9\u05dd",className:"chat-input",required:!0})),o.a.createElement("div",{className:"p-2"},o.a.createElement("input",{type:"number",onChange:g,value:d.age,name:"age",placeholder:"\u05d2\u05d9\u05dc",min:"1",className:"chat-input",required:!0})),o.a.createElement("div",{className:"p-2"},o.a.createElement("textarea",{onChange:g,value:d.reasonToIsolation,placeholder:"\u05e1\u05d9\u05d1\u05ea \u05d1\u05d9\u05d3\u05d5\u05d3",name:"reasonToIsolation",className:"chat-input",maxLength:"300",required:!0})),o.a.createElement("div",{className:"p-2"},o.a.createElement("input",{type:"submit",className:"btn btn-primary btn-lg",value:"\u05d4\u05ea\u05d7\u05d9\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8!"})))));default:return null}}())},x=(a(214),function(){return o.a.createElement("div",{className:"PageFooter fixed-bottom"},o.a.createElement("div",{className:"navbar"},o.a.createElement("div",{className:"float-left"},"Developed & designed by ",o.a.createElement("a",{href:"mailto:itai.sho@gmail.com?subject=\u05d4\u05d0\u05ea\u05e8 co-buddies \u05e9\u05dc\u05da"},"Itay Shoshani")),o.a.createElement("div",{className:"float-right"},o.a.createElement("a",{href:"https://github.com/itay-sho/co-buddies-server"},"Contribute")," to this project")))}),w=(a(215),a(216),function(){return o.a.createElement("div",{className:"App"},o.a.createElement(j,null),o.a.createElement(x,null))});S.a.defaults.baseURL="https://co-buddies.co.il/";var k=function(){r.a.render(o.a.createElement(h,null,o.a.createElement(w,null)),document.getElementById("root"))};N.initializeApp({apiKey:"AIzaSyCkWIV6dQbYlUa-jU07FZfXGJKC8Kpeb7Q",authDomain:"co-buddies.firebaseapp.com",databaseURL:"https://co-buddies.firebaseio.com",projectId:"co-buddies",storageBucket:"co-buddies.appspot.com",messagingSenderId:"988924831308",appId:"1:988924831308:web:e46ac712f53892b40ab6e9"});var R=!1;"serviceWorker"in navigator&&navigator.serviceWorker.register("".concat("https://co-buddies.co.il/static","/firebase-messaging-sw.js")).then((function(e){N.messaging().useServiceWorker(e),k(),R=!0})),R||(k(),R=!0)}},[[103,1,2]]]);
//# sourceMappingURL=main.20ff2b3b.chunk.js.map