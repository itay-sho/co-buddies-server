(this["webpackJsonpco-buddies"]=this["webpackJsonpco-buddies"]||[]).push([[0],{103:function(e,t,a){e.exports=a(217)},108:function(e,t,a){},109:function(e,t,a){},110:function(e,t,a){},114:function(e,t){},116:function(e,t){},149:function(e,t){},150:function(e,t){},196:function(e,t,a){},197:function(e,t,a){},214:function(e,t,a){},215:function(e,t,a){},217:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(102),c=a.n(r),s=(a(108),a(34)),l=a(12),u=a(5),i=(a(109),a(110),function(e){var t=e.text,a=e.author,n=e.user_id,r=localStorage.getItem("USER_ID"),c=n.toString()===r?"message-self":"message-other",s={};0===n&&(s.color="red");return o.a.createElement("div",{className:"Message "+c},o.a.createElement("div",{className:"message-author",style:s},[a]),o.a.createElement("div",{className:"message-text",style:{direction:function(e){return null!=e[0]&&e[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl"}(t)}},t))}),d={OK:0,UNAUTHENTICATED:100,CONVERSATION_CLOSED:101,SCHEMA_ERROR:102,UNIMPLEMENTED:103,CONVERSATION_NOT_INITIALIZED:104,AUTHENTICATION_TIMEOUT:105,AUTH_FAIL_USER_INACTIVE:106,AUTH_FAIL_INVALID_TOKEN:107,INACTIVENESS_TIMEOUT:108,UNKNOWN_ERROR:109},m=a(52),g=a.n(m),f=a(27),b=a.n(f),p=o.a.createContext({conversationId:0,setConversationId:function(){},websocket:null,setWebsocket:function(){},getNextSequenceNumber:function(){}}),v=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),r=a[0],c=a[1],s=Object(n.useState)(null),l=Object(u.a)(s,2),i=l[0],d=l[1],m=Object(n.useState)(1),g=Object(u.a)(m,2),f=g[0],b=g[1];return o.a.createElement(p.Provider,{value:{conversationId:r,setConversationId:c,websocket:i,setWebsocket:d,getNextSequenceNumber:function(){return b(f+1),f}}},e.children)},E=a(53),h=a.n(E),N=a(28),I=(a(101),function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)(null),s=Object(u.a)(c,2),m=s[0],f=s[1],v=Object(n.useRef)({0:"\u05d4\u05d5\u05d3\u05e2\u05ea \u05de\u05e2\u05e8\u05db\u05ea"}),E=Object(n.useRef)({}),I=Object(n.useRef)(),_=Object(n.useRef)(),O=Object(n.useContext)(p),y=localStorage.getItem("USER_ID"),S=function(e,t){console.log("Adding!");var a={};a[e]=t,E.current=g()(E.current,{$set:a})},w=function(e){r((function(t){return g()(t,{$push:[e]})}))},j=function(){return b.a.randomBytes(10).toString("hex")},x=function(e,t){return{user_id:e,text:t,key:j()}},T=function(e){return x(0,e)},k=function(){var e=O.getNextSequenceNumber(),t=JSON.stringify({request_type:"request_match",seq:e,payload:{}});_.current.send(t),console.log("match request sent!"),S(e,C)},A=function(){w(T("\u05d4\u05ea\u05d7\u05d1\u05e8\u05ea \u05d1\u05d4\u05e6\u05dc\u05d7\u05d4!")),k(),D()},C=function(){w(T("\u05de\u05d7\u05e4\u05e9 \u05e4\u05e8\u05d8\u05e0\u05e8\u05d9\u05dd \u05dc\u05e9\u05d9\u05d7\u05d4..."))},R=function(){var e=_.current,t=O.getNextSequenceNumber(),a=JSON.stringify({request_type:"authenticate",seq:t,payload:{access_token:localStorage.getItem("API_KEY")}});e.send(a),S(t,A)},U=function(){w(T("\u05d4\u05ea\u05e0\u05ea\u05e7\u05ea \u05de\u05d4\u05e9\u05e8\u05ea, \u05e0\u05e1\u05d4 \u05dc\u05e8\u05e4\u05e8\u05e9 \u05d0\u05ea \u05d4\u05d3\u05e3"))},q=function(e){console.log("New message: "+e.data);var t=JSON.parse(e.data);switch(t.request_type){case"error":return function(e){switch(e.payload.error_code){case d.OK:null!=e.payload.response_to&&(console.dir(E.current),console.log(e.payload.response_to),e.payload.response_to in E.current?E.current[e.payload.response_to]():console.log("got a success message for seq: "+e.payload.response_to));break;case d.AUTH_FAIL_INVALID_TOKEN:case d.AUTH_FAIL_USER_INACTIVE:w(T("\u05d4\u05e1\u05d9\u05e1\u05de\u05d4 \u05e9\u05e0\u05d9\u05ea\u05e0\u05d4 \u05e9\u05d2\u05d5\u05d9\u05d4 \u05d0\u05d5 \u05e9\u05d4\u05de\u05e9\u05ea\u05de\u05e9 \u05e0\u05d7\u05e1\u05dd. \u05de\u05ea\u05e0\u05ea\u05e7...")),localStorage.removeItem("API_KEY");break;case d.AUTHENTICATION_TIMEOUT:w(T("\u05d4\u05de\u05e2\u05e8\u05db\u05ea \u05e0\u05db\u05e9\u05dc\u05d4 \u05d1\u05d4\u05ea\u05d7\u05d1\u05e8\u05d5\u05ea"));break;case d.INACTIVENESS_TIMEOUT:w(T("\u05de\u05ea\u05e0\u05ea\u05e7 \u05d1\u05e2\u05e7\u05d1\u05d5\u05ea \u05d7\u05d5\u05e1\u05e8 \u05e4\u05e2\u05d9\u05dc\u05d5\u05ea...")),O.setConversationId(0);break;default:w(T("Unknown error: ".concat(e.payload.error_code," ").concat(e.payload.error_message)))}}(t);case"receive_match":return function(e){var t=localStorage.getItem("USER_ID"),a="";console.log(e.payload.attendees);for(var n=0,o=Object.entries(e.payload.attendees);n<o.length;n++){var r=Object(u.a)(o[n],2),c=r[0],s=r[1];t!==c&&(a+=s);var i=Object(l.a)({},v.current);i[c]=s,v.current=i}w(T("\u05d0\u05ea\u05d4 \u05de\u05d3\u05d1\u05e8 \u05e2\u05dd "+a)),O.setConversationId(e.payload.conversation_id)}(t);case"receive_message":return function(e){null!==m&&e.payload.author_id.toString()!==y&&m.play(),w(x(e.payload.author_id,e.payload.text))}(t);case"disconnect":return function(e){console.log(e.payload),console.log(v.current),console.log(v.current[e.payload.user_id]);var t=v.current[e.payload.user_id];w(T("".concat(t," \u05e2\u05d6\u05d1 \u05d0\u05ea \u05d4\u05e9\u05d9\u05d7\u05d4."))),O.setConversationId(0),k()}(t);default:return function(e){w(T("\u05d4\u05d5\u05d3\u05e2\u05d4 \u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2\u05d4! :"+JSON.stringify(e)))}(t)}},D=Object(n.useCallback)((function(){var e=N.messaging();e.getToken().then((function(e){console.log("token:",e);var t=O.getNextSequenceNumber(),a=JSON.stringify({request_type:"set_pn_token",seq:t,payload:{token:e}});O.websocket.send(a)})).catch((function(e){console.log(e)})),e.onMessage((function(e){console.log("message",e)}))}),[O]);Object(n.useEffect)((function(){console.log("useEffect"),void 0===_.current&&(console.log("setting web socket..."),_.current=new WebSocket("wss://co-buddies.co.il/chat"),w({key:j(),user_id:0,text:"\u05de\u05ea\u05d7\u05d1\u05e8 \u05d0\u05dc \u05d4\u05e9\u05e8\u05ea..."})),_.current.onopen=R,_.current.onclose=U,_.current.onmessage=q,O.setWebsocket(_.current),I.current.scroll({top:I.current.scrollHeight,behavior:"smooth"})}),[_,R,U,q]),Object(n.useEffect)((function(){h.a.soundManager.onready((function(){if(null===m){var e=h.a.soundManager.createSound({url:"".concat("https://co-buddies.co.il/static","/new-message.wav")});f(e)}}))}),[]);var K={backgroundImage:"url(".concat("https://co-buddies.co.il/static","/chat_bg.png)")};return o.a.createElement("div",{className:"ChatBox",ref:I,style:K},a.map((function(e){return o.a.createElement("div",{key:e.key,className:"p-2"},o.a.createElement(i,{text:e.text,author:v.current[e.user_id],user_id:e.user_id}))})))}),_=(a(196),o.a.forwardRef((function(e,t){var a=e.enterAction,r=e.disabled,c=Object(n.useState)({rows:e.rows,minRows:e.minRows,maxRows:e.maxRows,value:""}),s=Object(u.a)(c,2),i=s[0],d=s[1],m=Object(n.useState)({resize:"none",width:"100%",lineHeight:"24px",direction:"rtl"}),g=Object(u.a)(m,2),f=g[0],b=g[1];t.current=[i,d];return o.a.createElement("textarea",{disabled:r,maxLength:"500",rows:i.rows,placeholder:"\u05d4\u05e7\u05dc\u05d3\\\u05d9 \u05d4\u05d5\u05d3\u05e2\u05d4",className:"ResizeableTextarea",onKeyDown:function(e){if(13===e.keyCode&&!1===e.shiftKey){e.preventDefault();e.target.value;a()}},onChange:function(e){var t=i.minRows,a=i.maxRows,n=e.target.rows;e.target.rows=t;var o,r=~~((e.target.scrollHeight-20)/24);r===n&&(e.target.rows=r),r>=a&&(e.target.rows=a,e.target.scrollTop=e.target.scrollHeight),b(Object(l.a)({},f,{direction:(o=e.target,null!=o.value[0]&&o.value[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl")})),d(Object(l.a)({},i,{rows:r<a?r:a,value:e.target.value}))},style:f,value:i.value})}))),O=(a(197),function(){var e=Object(n.useContext)(p),t=0===e.conversationId,a=Object(n.useRef)(),r=function(){var n=Object(u.a)(a.current,2),o=n[0],r=n[1],c=o.value;if(!t&&0!==c.length){var s=e.getNextSequenceNumber(),i=JSON.stringify({request_type:"send_message",seq:s,payload:{text:c}});r(Object(l.a)({},o,{value:""})),e.websocket.send(i)}};return o.a.createElement("div",{className:"ChatInput mt-auto"},o.a.createElement("div",{className:"p-2 d-flex"},o.a.createElement(_,{ref:a,rows:"1",minRows:"1",maxRows:"5",enterAction:r,disabled:t}),o.a.createElement("div",{className:"p2 d-flex align-items-center send-button-wrapper"},o.a.createElement("img",{alt:"logo",src:"https://co-buddies.co.il/static/send_button.png",className:"send-button",onClick:r}))))}),y=a(35),S=a.n(y),w=function(){var e=Object(n.useState)(null!==localStorage.getItem("API_KEY")?"chat":"welcome"),t=Object(u.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)({fullName:"",age:"",reasonToIsolation:""}),i=Object(u.a)(c,2),d=i[0],m=i[1],g=function(e){var t=e.target.name;m(Object(l.a)({},d,Object(s.a)({},t,e.target.value)))},f=function(e){e.preventDefault();var t=b.a.randomBytes(10).toString("hex"),a=b.a.randomBytes(20).toString("hex");S.a.post("/registration/",{username:t,password1:a,password2:a,name:d.fullName,reason_to_isolation:d.reasonToIsolation,age:d.age}).then((function(e){201===e.status?(localStorage.setItem("API_KEY",e.data.key),localStorage.setItem("USER_ID",e.data.id),r("chat")):alert(e.status)}))};return o.a.createElement("div",{className:"ChatContainer container"},function(){switch(a){case"chat":return o.a.createElement("div",{className:"d-flex flex-column chat-flex"},o.a.createElement(I,null),o.a.createElement(O,null));case"welcome":return o.a.createElement("div",{className:"d-flex flex-column chat-flex justify-content-center"},o.a.createElement("div",{className:"text-center rtl no-chat-windows"},o.a.createElement("img",{src:"https://co-buddies.co.il/static/logo.png",alt:"logo",className:"logo"}),o.a.createElement("p",null,"\u05d1\u05e8\u05d5\u05db\u05d9\u05dd \u05d4\u05d1\u05d0\u05d9\u05dd \u05dc\u05d0\u05ea\u05e8 Co-Buddies!",o.a.createElement("br",null),"\u05d1\u05d0\u05ea\u05e8 \u05ea\u05d5\u05db\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8 \u05e2\u05dd \u05d7\u05d1\u05e8\u05d9\u05dd \u05e0\u05d5\u05e1\u05e4\u05d9\u05dd \u05d4\u05e0\u05de\u05e6\u05d0\u05d9\u05dd \u05d1\u05d1\u05d9\u05d3\u05d5\u05d3"),o.a.createElement("form",{onSubmit:f},o.a.createElement("div",{className:"p-2"},o.a.createElement("input",{type:"text",onChange:g,value:d.fullName,name:"fullName",placeholder:"\u05e9\u05dd",className:"chat-input",required:!0})),o.a.createElement("div",{className:"p-2"},o.a.createElement("input",{type:"number",onChange:g,value:d.age,name:"age",placeholder:"\u05d2\u05d9\u05dc",min:"1",className:"chat-input",required:!0})),o.a.createElement("div",{className:"p-2"},o.a.createElement("textarea",{onChange:g,value:d.reasonToIsolation,placeholder:"\u05e1\u05d9\u05d1\u05ea \u05d1\u05d9\u05d3\u05d5\u05d3",name:"reasonToIsolation",className:"chat-input",maxLength:"300",required:!0})),o.a.createElement("div",{className:"p-2"},o.a.createElement("input",{type:"submit",className:"btn btn-primary btn-lg",value:"\u05d4\u05ea\u05d7\u05d9\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8!"})))));default:return null}}())},j=(a(214),function(){return o.a.createElement("div",{className:"PageFooter fixed-bottom"},o.a.createElement("div",{className:"navbar"},o.a.createElement("div",{className:"float-left"},"Developed & designed by ",o.a.createElement("a",{href:"mailto:itai.sho@gmail.com?subject=\u05d4\u05d0\u05ea\u05e8 co-buddies \u05e9\u05dc\u05da"},"Itay Shoshani")),o.a.createElement("div",{className:"float-right"},o.a.createElement("a",{href:"https://github.com/itay-sho/co-buddies-server"},"Contribute")," to this project")))}),x=(a(215),a(216),function(){return o.a.createElement("div",{className:"App"},o.a.createElement(w,null),o.a.createElement(j,null))});S.a.defaults.baseURL="https://co-buddies.co.il/";var T=function(){c.a.render(o.a.createElement(v,null,o.a.createElement(x,null)),document.getElementById("root"))};N.initializeApp({apiKey:"AIzaSyCkWIV6dQbYlUa-jU07FZfXGJKC8Kpeb7Q",authDomain:"co-buddies.firebaseapp.com",databaseURL:"https://co-buddies.firebaseio.com",projectId:"co-buddies",storageBucket:"co-buddies.appspot.com",messagingSenderId:"988924831308",appId:"1:988924831308:web:e46ac712f53892b40ab6e9"}),navigator.serviceWorker.register("".concat("https://co-buddies.co.il/static","/firebase-messaging-sw.js")).then((function(e){N.messaging().useServiceWorker(e),T()})).catch((function(){T()}))}},[[103,1,2]]]);
//# sourceMappingURL=main.7420c036.chunk.js.map