(this["webpackJsonpco-buddies"]=this["webpackJsonpco-buddies"]||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){},102:function(e,t,a){},106:function(e,t){},108:function(e,t){},142:function(e,t){},143:function(e,t){},185:function(e,t,a){},186:function(e,t,a){},203:function(e,t,a){},204:function(e,t,a){},206:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(94),c=a.n(o),s=(a(100),a(29)),l=a(12),u=a(5),i=(a(101),a(102),function(e){var t=e.text,a=e.author,n=e.user_id,o=localStorage.getItem("USER_ID"),c=n.toString()===o?"message-self":"message-other",s={};0===n&&(s.color="red");return r.a.createElement("div",{className:"Message "+c},r.a.createElement("div",{className:"message-author",style:s},[a]),r.a.createElement("div",{className:"message-text",style:{direction:function(e){return null!=e[0]&&e[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl"}(t)}},t))}),d={OK:0,UNAUTHENTICATED:100,CONVERSATION_CLOSED:101,SCHEMA_ERROR:102,UNIMPLEMENTED:103,CONVERSATION_NOT_INITIALIZED:104,TIMEOUT:105,USER_INACTIVE:106,INVALID_TOKEN:107,UNKNOWN_ERROR:108},m=a(47),f=a.n(m),g=a(23),v=a.n(g),p=r.a.createContext({conversationId:0,setConversationId:function(){},websocket:null,setWebsocket:function(){},getNextSequenceNumber:function(){}}),b=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),o=a[0],c=a[1],s=Object(n.useState)(null),l=Object(u.a)(s,2),i=l[0],d=l[1],m=Object(n.useState)(1),f=Object(u.a)(m,2),g=f[0],v=f[1];return r.a.createElement(p.Provider,{value:{conversationId:o,setConversationId:c,websocket:i,setWebsocket:d,getNextSequenceNumber:function(){return v(g+1),g}}},e.children)},E=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],o=t[1],c=Object(n.useRef)({0:"\u05d4\u05d5\u05d3\u05e2\u05d4 \u05de\u05e2\u05e8\u05db\u05ea"}),s=Object(n.useRef)({}),m=Object(n.useRef)(),g=Object(n.useRef)(),b=Object(n.useContext)(p),E=function(e,t){console.log("Adding!");var a={};a[e]=t,s.current=f()(s.current,{$set:a})},h=function(e){o((function(t){return f()(t,{$push:[e]})}))},N=function(){return v.a.randomBytes(10).toString("hex")},O=function(e,t){return{user_id:e,text:t,key:N()}},_=function(e){return O(0,e)},y=function(){var e=b.getNextSequenceNumber(),t=JSON.stringify({request_type:"request_match",seq:e,payload:{}});g.current.send(t),E(e,I)},S=function(){h(_("\u05d4\u05ea\u05d7\u05d1\u05e8\u05ea \u05d1\u05d4\u05e6\u05dc\u05d7\u05d4!")),y()},I=function(){h(_("\u05de\u05d7\u05e4\u05e9 \u05e4\u05e8\u05d8\u05e0\u05e8\u05d9\u05dd \u05dc\u05e9\u05d9\u05d7\u05d4..."))},w=function(e){var t=g.current,a=b.getNextSequenceNumber(),n=JSON.stringify({request_type:"authenticate",seq:a,payload:{access_token:localStorage.getItem("API_KEY")}});t.send(n),E(a,S)},x=function(e){h(_("\u05d4\u05ea\u05e0\u05ea\u05e7\u05ea \u05de\u05d4\u05e9\u05e8\u05ea, \u05e0\u05e1\u05d4 \u05dc\u05e8\u05e4\u05e8\u05e9 \u05d0\u05ea \u05d4\u05d3\u05e3"))},j=function(e){console.log("New message: "+e.data);var t=JSON.parse(e.data);switch(t.request_type){case"error":return function(e){switch(e.payload.error_code){case d.OK:null!=e.payload.response_to&&(console.dir(s.current),console.log(e.payload.response_to),e.payload.response_to in s.current?s.current[e.payload.response_to]():console.log("got a success message for seq: "+e.payload.response_to));break;case d.INVALID_TOKEN:case d.USER_INACTIVE:h(_("\u05d4\u05e1\u05d9\u05e1\u05de\u05d4 \u05e9\u05e0\u05d9\u05ea\u05e0\u05d4 \u05e9\u05d2\u05d5\u05d9\u05d4 \u05d0\u05d5 \u05e9\u05d4\u05de\u05e9\u05ea\u05de\u05e9 \u05e0\u05d7\u05e1\u05dd. \u05de\u05ea\u05e0\u05ea\u05e7...")),localStorage.removeItem("API_KEY");break;case d.TIMEOUT:h(_("\u05d4\u05de\u05e2\u05e8\u05db\u05ea \u05e0\u05db\u05e9\u05dc\u05d4 \u05d1\u05d4\u05ea\u05d7\u05d1\u05e8\u05d5\u05ea"));break;default:h(_("Unknown error: ".concat(e.payload.error_code," ").concat(e.payload.error_message)))}}(t);case"receive_match":return function(e){var t=localStorage.getItem("USER_ID"),a="";console.log(e.payload.attendees);for(var n=0,r=Object.entries(e.payload.attendees);n<r.length;n++){var o=Object(u.a)(r[n],2),s=o[0],i=o[1];t!==s&&(a+=i);var d=Object(l.a)({},c.current);d[s]=i,c.current=d}h(_("\u05d0\u05ea\u05d4 \u05de\u05d3\u05d1\u05e8 \u05e2\u05dd "+a)),b.setConversationId(e.payload.conversationId)}(t);case"receive_message":return function(e){h(O(e.payload.author_id,e.payload.text))}(t);case"disconnect":return function(e){console.log(e.payload),console.log(c.current),console.log(c.current[e.payload.user_id]);var t=c.current[e.payload.user_id];h(_("".concat(t," \u05e2\u05d6\u05d1 \u05d0\u05ea \u05d4\u05e9\u05d9\u05d7\u05d4."))),b.setConversationId(0),y()}(t);default:return function(e){h(_("\u05d4\u05d5\u05d3\u05e2\u05d4 \u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2\u05d4! :"+JSON.stringify(e)))}(t)}};return Object(n.useEffect)((function(){console.log("useEffect"),void 0===g.current&&(console.log("setting web socket..."),g.current=new WebSocket(Object({NODE_ENV:"production",PUBLIC_URL:"https://co-buddies.co.il",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).WEBSOCKET_URL),h({key:N(),user_id:0,text:"\u05de\u05ea\u05d7\u05d1\u05e8 \u05d0\u05dc \u05d4\u05e9\u05e8\u05ea..."})),g.current.onopen=w,g.current.onclose=x,g.current.onmessage=j,b.setWebsocket(g.current),m.current.scroll({top:m.current.scrollHeight,behavior:"smooth"})}),[g,w,x,j]),r.a.createElement("div",{className:"ChatBox",ref:m},a.map((function(e){return r.a.createElement("div",{key:e.key,className:"p-2"},r.a.createElement(i,{text:e.text,author:c.current[e.user_id],user_id:e.user_id}))})))},h=(a(185),r.a.forwardRef((function(e,t){var a=e.enterAction,o=e.disabled,c=Object(n.useState)({rows:e.rows,minRows:e.minRows,maxRows:e.maxRows,value:""}),s=Object(u.a)(c,2),i=s[0],d=s[1],m=Object(n.useState)({resize:"none",width:"100%",lineHeight:"24px",direction:"rtl"}),f=Object(u.a)(m,2),g=f[0],v=f[1];t.current=[i,d];return r.a.createElement("textarea",{disabled:o,maxLength:"500",rows:i.rows,placeholder:"\u05d4\u05e7\u05dc\u05d3\\\u05d9 \u05d4\u05d5\u05d3\u05e2\u05d4",className:"ResizeableTextarea",onKeyDown:function(e){if(13===e.keyCode&&!1===e.shiftKey){e.preventDefault();e.target.value;a()}},onChange:function(e){var t=i.minRows,a=i.maxRows,n=e.target.rows;e.target.rows=t;var r,o=~~((e.target.scrollHeight-20)/24);o===n&&(e.target.rows=o),o>=a&&(e.target.rows=a,e.target.scrollTop=e.target.scrollHeight),v(Object(l.a)({},g,{direction:(r=e.target,null!=r.value[0]&&r.value[0].search(/[\u0590-\u05FF]/)<0?"ltr":"rtl")})),d(Object(l.a)({},i,{rows:o<a?o:a,value:e.target.value}))},style:g,value:i.value})}))),N=(a(186),function(){var e=Object(n.useContext)(p),t=0===e.conversationId,a=Object(n.useRef)(),o=function(){var n=Object(u.a)(a.current,2),r=n[0],o=n[1],c=r.value;if(!t&&0!==c.length){var s=e.getNextSequenceNumber(),i=JSON.stringify({request_type:"send_message",seq:s,payload:{text:c}});o(Object(l.a)({},r,{value:""})),e.websocket.send(i)}};return r.a.createElement("div",{className:"ChatInput mt-auto"},r.a.createElement("div",{className:"p-2 d-flex"},r.a.createElement(h,{ref:a,rows:"1",minRows:"1",maxRows:"5",enterAction:o,disabled:t}),r.a.createElement("div",{className:"p2 d-flex align-items-center send-button-wrapper"},r.a.createElement("img",{alt:"logo",src:"https://co-buddies.co.il/send_button.png",className:"send-button",onClick:o}))))}),O=a(30),_=a.n(O),y=function(){var e=Object(n.useState)(null!==localStorage.getItem("API_KEY")?"chat":"welcome"),t=Object(u.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)({fullName:"",age:"",reasonToIsolation:""}),i=Object(u.a)(c,2),d=i[0],m=i[1],f=function(e){var t=e.target.name;m(Object(l.a)({},d,Object(s.a)({},t,e.target.value)))},g=function(e){e.preventDefault();var t=v.a.randomBytes(10).toString("hex"),a=v.a.randomBytes(20).toString("hex");_.a.post("/registration/",{username:t,password1:a,password2:a,name:d.fullName,reason_to_isolation:d.reasonToIsolation,age:d.age}).then((function(e){201===e.status?(localStorage.setItem("API_KEY",e.data.key),localStorage.setItem("USER_ID",e.data.id),o("chat")):alert(e.status)}))};return r.a.createElement("div",{className:"ChatContainer container"},function(){switch(a){case"chat":return r.a.createElement("div",{className:"d-flex flex-column chat-flex"},r.a.createElement(E,null),r.a.createElement(N,null));case"welcome":return r.a.createElement("div",{className:"d-flex flex-column chat-flex justify-content-center"},r.a.createElement("div",{className:"text-center rtl no-chat-windows"},r.a.createElement("img",{src:"https://co-buddies.co.il/logo.png",alt:"logo",className:"logo"}),r.a.createElement("p",null,"\u05d1\u05e8\u05d5\u05db\u05d9\u05dd \u05d4\u05d1\u05d0\u05d9\u05dd \u05dc\u05d0\u05ea\u05e8 Co-Buddies!",r.a.createElement("br",null),"\u05d1\u05d0\u05ea\u05e8 \u05ea\u05d5\u05db\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8 \u05e2\u05dd \u05d7\u05d1\u05e8\u05d9\u05dd \u05e0\u05d5\u05e1\u05e4\u05d9\u05dd \u05d4\u05e0\u05de\u05e6\u05d0\u05d9\u05dd \u05d1\u05d1\u05d9\u05d3\u05d5\u05d3"),r.a.createElement("form",{onSubmit:g},r.a.createElement("div",{className:"p-2"},r.a.createElement("input",{type:"text",onChange:f,value:d.fullName,name:"fullName",placeholder:"\u05e9\u05dd",className:"chat-input",required:!0})),r.a.createElement("div",{className:"p-2"},r.a.createElement("input",{type:"number",onChange:f,value:d.age,name:"age",placeholder:"\u05d2\u05d9\u05dc",min:"1",className:"chat-input",required:!0})),r.a.createElement("div",{className:"p-2"},r.a.createElement("textarea",{onChange:f,value:d.reasonToIsolation,placeholder:"\u05e1\u05d9\u05d1\u05ea \u05d1\u05d9\u05d3\u05d5\u05d3",name:"reasonToIsolation",className:"chat-input",maxLength:"300",required:!0})),r.a.createElement("div",{className:"p-2"},r.a.createElement("input",{type:"submit",className:"btn btn-primary btn-lg",value:"\u05d4\u05ea\u05d7\u05d9\u05dc\u05d5 \u05dc\u05e6'\u05d5\u05d8\u05d8!"})))));default:return null}}())},S=(a(203),function(){return r.a.createElement("div",{className:"PageFooter fixed-bottom"},r.a.createElement("div",{className:"navbar"},r.a.createElement("div",{className:"float-left"},"Developed & designed by ",r.a.createElement("a",{href:"mailto:itai.sho@gmail.com?subject=\u05d4\u05d0\u05ea\u05e8 co-buddies \u05e9\u05dc\u05da"},"Itay Shoshani")),r.a.createElement("div",{className:"float-right"},r.a.createElement("a",{href:"https://github.com/itay-sho/co-buddies-server"},"Contribute")," to this project")))}),I=(a(204),a(205),function(){return r.a.createElement("div",{className:"App"},r.a.createElement(y,null),r.a.createElement(S,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));_.a.defaults.baseURL="https://co-buddies.co.il",c.a.render(r.a.createElement(b,null,r.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},95:function(e,t,a){e.exports=a(206)}},[[95,1,2]]]);
//# sourceMappingURL=main.b0eac005.chunk.js.map